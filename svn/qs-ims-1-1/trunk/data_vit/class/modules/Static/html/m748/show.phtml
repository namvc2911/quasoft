<?php
$stt            = 0;
$excel_col      = array_flip(Qss_Lib_Const::$EXCEL_COLUMN);
$bg             = Qss_Lib_Extra_Const::REPORT_EXCEL_THEAD_COLOR;
$row            = 2;
$widthArr       = array(1, 4, 4, 3, 3, 3, 5, 4, 2, 2, 2);
$totalCol       = count($widthArr) ;
$htmlColWidths  = Qss_Lib_Report::changeWidthToFitScreen($widthArr, Qss_Lib_Extra_Const::PRINT_TYPE_LANDSCAPE);
$excelColWidths = Qss_Lib_Report::convertPxColumnWidthToExcelWidth($widthArr, Qss_Lib_Extra_Const::PRINT_TYPE_LANDSCAPE);
?>

<form id="excel" method="post" action="/report/index/excel" target="new">
    <input type="hidden" id="content" name="content" value="">
</form>

<div class="landscape">
    <excel orientation="landscape"
           font-name="Arial"
           font-size="9"
           margin-left="0.5"
           margin-right="0.5"
           margin-top="0.75"
           margin-bottom="0.75" />

    <div id="head_print">
        <?php echo $this->views->Common->Landscape() ?>

        <center>
            <h2>
                <xls
                    row="<?php echo $row?>"
                    column="A"
                    column-merge="<?php echo $excel_col[$totalCol]?>"
                    font-size="12"
                    wrap-text="1"
                    h-align="center"
                    bold="1"
                    v-align="center"> <?php echo $this->_translate(1)?> </xls>
            </h2>
        </center>
    </div>
    <?php $row++ ?>


    <div>
        <?php
        $subTitle = $this->_translate(2).": ";
        $eCode    = $this->equip?$this->equip->MaThietBi:'';
        $eName    = $this->equip?$this->equip->TenThietBi:'';
        $loc      = $this->location?$this->location->Ten:'';
        $lECode   = (20 - strlen($eCode)) > 0?20 - strlen($eCode):0;
        $lEName   = (30 - strlen($eName)) > 0?30 - strlen($eName):0;
        $lLoc     = (40 - strlen($loc)) > 0?40 - strlen($loc):0;
        $subTitle.= $eCode.str_repeat("&nbsp;", $lECode);
        $subTitle.= ' ';
        $subTitle.= $this->_translate(3).": ";
        $subTitle.= $eName.str_repeat("&nbsp;", $lEName);
        $subTitle.= ' ';
        $subTitle.= $this->_translate(31).": ";
        $subTitle.= $loc.str_repeat("&nbsp;", $lLoc);
        ?>
        <center>
            <xls
                row="<?php echo $row ?>"
                column="A"
                column-merge="<?php echo $excel_col[$totalCol] ?>"
                font-size="<?php echo Qss_Lib_Extra_Const::REPORT_EXCEL_TITLE_FONT_SIZE;?>"
                wrap-text="1"
                h-align="center"
                v-align="center" > <?php echo $subTitle;?> </xls>
        </center>
    </div>
    <?php $row++; ?>
    <?php $row++; ?>

    <br/>

    <div id="container">
        <table width="100%" cellpadding="0" cellspacing="0" class="border" border="1">
            <tr class="bggrey">
                <?php $begin = 0; ?>

                <!-- STT -->
                <th class="center" style="width: <?php echo $htmlColWidths[$begin];?>px">
                    <xls
                        row="<?php echo $row?>"
                        width="<?php echo $excelColWidths[$begin];?>"
                        column="<?php echo $excel_col[++$begin]?>"
                        wrap-text="1"
                        v-align="center"
                        h-align="center"
                        border="1"
                        repeat="1"
                        bold="1"
                        bgcolor="<?php echo $bg;?>"> <?php echo $this->_translate(26)?> </xls>
                </th>

                <!-- Mã thiết bị -->
                <th class="center" style="width: <?php echo $htmlColWidths[$begin];?>px">
                    <xls
                        row="<?php echo $row?>"
                        width="<?php echo $excelColWidths[$begin];?>"
                        column="<?php echo $excel_col[++$begin]?>"
                        wrap-text="1"
                        v-align="center"
                        h-align="center"
                        border="1"
                        repeat="1"
                        bold="1"
                        bgcolor="<?php echo $bg;?>"> <?php echo $this->_translate(2)?> </xls>
                </th>

                <!-- Tên thiết bị -->
                <th class="center" style="width: <?php echo $htmlColWidths[$begin];?>px">
                    <xls
                        row="<?php echo $row?>"
                        width="<?php echo $excelColWidths[$begin];?>"
                        column="<?php echo $excel_col[++$begin]?>"
                        wrap-text="1"
                        v-align="center"
                        h-align="center"
                        border="1"
                        repeat="1"
                        bold="1"
                        bgcolor="<?php echo $bg;?>"> <?php echo $this->_translate(3)?> </xls>
                </th>

                <!-- Bộ phận -->
                <th class="center" style="width: <?php echo $htmlColWidths[$begin];?>px">
                    <xls
                        row="<?php echo $row?>"
                        width="<?php echo $excelColWidths[$begin];?>"
                        column="<?php echo $excel_col[++$begin]?>"
                        wrap-text="1"
                        v-align="center"
                        h-align="center"
                        border="1"
                        repeat="1"
                        bold="1"
                        bgcolor="<?php echo $bg;?>"> <?php echo $this->_translate(27)?> </xls>
                </th>

                <!-- Loại bảo trì -->
                <th class="center" style="width: <?php echo $htmlColWidths[$begin];?>px">
                    <xls
                        row="<?php echo $row?>"
                        width="<?php echo $excelColWidths[$begin];?>"
                        column="<?php echo $excel_col[++$begin]?>"
                        wrap-text="1"
                        v-align="center"
                        h-align="center"
                        border="1"
                        repeat="1"
                        bold="1"
                        bgcolor="<?php echo $bg;?>"> <?php echo $this->_translate(4)?> </xls>
                </th>

                <!-- Ngày bảo trì -->
                <th class="center" style="width: <?php echo $htmlColWidths[$begin];?>px">
                    <xls
                        row="<?php echo $row?>"
                        width="<?php echo $excelColWidths[$begin];?>"
                        column="<?php echo $excel_col[++$begin]?>"
                        wrap-text="1"
                        v-align="center"
                        h-align="center"
                        border="1"
                        repeat="1"
                        bold="1"
                        bgcolor="<?php echo $bg;?>"> <?php echo $this->_translate(5)?> </xls>
                </th>

                <!-- Công việc bảo trì -->
                <th class="center" style="width: <?php echo $htmlColWidths[$begin];?>px">
                    <xls
                        row="<?php echo $row?>"
                        width="<?php echo $excelColWidths[$begin];?>"
                        column="<?php echo $excel_col[++$begin]?>"
                        wrap-text="1"
                        v-align="center"
                        h-align="center"
                        border="1"
                        repeat="1"
                        bold="1"
                        bgcolor="<?php echo $bg;?>"> <?php echo $this->_translate(6)?> </xls>
                </th>

                <!-- Vật tư thay thế -->
                <th class="center" style="width: <?php echo $htmlColWidths[$begin];?>px">
                    <xls
                        row="<?php echo $row?>"
                        width="<?php echo $excelColWidths[$begin];?>"
                        column="<?php echo $excel_col[++$begin]?>"
                        wrap-text="1"
                        v-align="center"
                        h-align="center"
                        border="1"
                        repeat="1"
                        bold="1"
                        bgcolor="<?php echo $bg;?>"> <?php echo $this->_translate(7)?> </xls>
                </th>

                <!-- Số lượng -->
                <th class="center" style="width: <?php echo $htmlColWidths[$begin];?>px">
                    <xls
                        row="<?php echo $row?>"
                        width="<?php echo $excelColWidths[$begin];?>"
                        column="<?php echo $excel_col[++$begin]?>"
                        wrap-text="1"
                        v-align="center"
                        h-align="center"
                        border="1"
                        repeat="1"
                        bold="1"
                        bgcolor="<?php echo $bg;?>"> <?php echo $this->_translate(28)?> </xls>
                </th>

                <!-- Đvt -->
                <th class="center" style="width: <?php echo $htmlColWidths[$begin];?>px">
                    <xls
                        row="<?php echo $row?>"
                        width="<?php echo $excelColWidths[$begin];?>"
                        column="<?php echo $excel_col[++$begin]?>"
                        wrap-text="1"
                        v-align="center"
                        h-align="center"
                        border="1"
                        repeat="1"
                        bold="1"
                        bgcolor="<?php echo $bg;?>"> <?php echo $this->_translate(29)?> </xls>
                </th>


                <!-- Ghi chú -->
                <th class="center" style="width: <?php echo $htmlColWidths[$begin];?>px">
                    <xls
                        row="<?php echo $row?>"
                        width="<?php echo $excelColWidths[$begin];?>"
                        column="<?php echo $excel_col[++$begin]?>"
                        wrap-text="1"
                        v-align="center"
                        h-align="center"
                        border="1"
                        repeat="1"
                        bold="1"
                        bgcolor="<?php echo $bg;?>"> <?php echo $this->_translate(30)?> </xls>
                </th>
            </tr>
            <?php $row++; ?>


            <?php foreach ($this->report as $dat): ?>
                <?php $begin = 0; ?>
                <tr>
                    <!-- Stt -->
                    <td class="center">
                        <xls row="<?php echo $row?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             wrap-text="1"
                             h-align="center"
                             v-align="center"
                             border="1"> <?php echo ++$stt;?></xls>
                    </td>

                    <!-- Mã thiết bị -->
                    <td class="left">
                        <xls row="<?php echo $row?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             wrap-text="1"
                             h-align="left"
                             v-align="center"
                             border="1"> <?php echo $dat->MaThietBi;?></xls>
                    </td>

                    <!-- Tên thiết bị -->
                    <td class="left">
                        <xls row="<?php echo $row?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             wrap-text="1"
                             h-align="left"
                             v-align="center"
                             border="1"> <?php echo $dat->TenThietBi;?></xls>
                    </td>

                    <!-- Bộ phận -->
                    <?php $boPhan = $dat->ViTri?"{$dat->ViTri} - {$dat->BoPhan}":'';?>
                    <td class="left">
                        <xls row="<?php echo $row?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             wrap-text="1"
                             h-align="left"
                             v-align="center"
                             border="1"> <?php echo $boPhan;?></xls>
                    </td>

                    <!-- Loại bảo trì -->
                    <td class="left">
                        <xls row="<?php echo $row?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             wrap-text="1"
                             h-align="left"
                             v-align="center"
                             border="1"> <?php echo $dat->MoTaKeHoach;?></xls>
                    </td>

                    <!-- Ngày bảo trì -->
                    <td class="center">
                        <xls row="<?php echo $row?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             wrap-text="1"
                             h-align="center"
                             v-align="center"
                             border="1"> <?php // echo Qss_Lib_Date::mysqltodisplay($dat->NgayBaoTri);?></xls>
                    </td>

                    <!-- Công việc bảo trì -->
                    <td class="left">
                        <xls row="<?php echo $row?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             wrap-text="1"
                             h-align="left"
                             v-align="center"
                             border="1"> <?php echo $dat->MoTaCongViec;?></xls>
                    </td>

                    <!-- Vật tư thay thế -->
                    <?php $vatTu = $dat->MaVatTu?"{$dat->MaVatTu} - {$dat->TenVatTu}":'';?>
                    <td class="left">
                        <xls row="<?php echo $row?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             wrap-text="1"
                             h-align="left"
                             v-align="center"
                             border="1"> <?php echo $vatTu;?></xls>
                    </td>

                    <!-- Số lượng -->
                    <td class="right">
                        <xls row="<?php echo $row?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             wrap-text="1"
                             h-align="right"
                             v-align="center"
                             border="1"> <?php echo Qss_Lib_Util::formatNumber($dat->SoLuong);?></xls>
                    </td>

                    <!-- Đvt-->
                    <td class="left">
                        <xls row="<?php echo $row?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             wrap-text="1"
                             h-align="left"
                             v-align="center"
                             border="1"> <?php echo $dat->DonViTinh;?></xls>
                    </td>

                    <!-- Ghi chú -->
                    <td class="left">
                        <xls row="<?php echo $row?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             wrap-text="1"
                             h-align="left"
                             v-align="center"
                             border="1"> </xls>
                    </td>
                </tr>
                <?php $row++; ?>
            <?php endforeach; ?>
        </table>

        <br/>
        <br/>
        <?php $row++;?>

        <div>
            <table width="" cellpadding="0" cellspacing="0" class="" border="0">
                <tr>
                    <td class="right" colspan="<?php echo $totalCol;?>">
                        <xls row="<?php echo $row?>"
                             column="A"
                             column-merge="<?php echo $excel_col[$totalCol]?>"
                             wrap-text="1"
                             h-align="right"
                             v-align="center"
                             border="0"
                             bold="0"
                            ><?php if($this->deptid == 1):?>Bắc Ninh<?php else:?>Thái Bình<?php endif;?>, Ngày..........Tháng..........Năm..........</xls>
                    </td>
                </tr>
                <?php $row++;?>
                <?php $row++;?>

                <tr>
                    <th colspan="<?php echo $totalCol;?>">&nbsp;</th>
                </tr>

                <tr>
                    <?php $begin = 0;?>

                    <?php $htmlWidthNguoiLap = $htmlColWidths[0] + $htmlColWidths[1] + $htmlColWidths[2];?>
                    <?php $excelWidthNguoiLap = $excelColWidths[0] + $excelColWidths[1] + $excelColWidths[2] ;?>
                    <th colspan="3" class="center" width="<?php echo $htmlWidthNguoiLap;?>px">
                        <xls row="<?php echo $row?>"
                             width="<?php echo $excelWidthNguoiLap;?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             column-merge="<?php echo $excel_col[$begin+2]?>"
                             wrap-text="1"
                             h-align="center"
                             v-align="center"
                             border="0"
                             bold="1"> Người lập</xls>
                    </th>
                    <?php $begin = $begin+2;?>

                    <?php $htmlWidthGDPX = $htmlColWidths[4] + $htmlColWidths[5] + $htmlColWidths[6] + $htmlColWidths[3];?>
                    <?php $excelWidthGDPX = $excelColWidths[4] + $excelColWidths[5] + $excelColWidths[6] + $excelColWidths[3];?>
                    <th colspan="4" class="center" width="<?php echo $htmlWidthGDPX;?>px">
                        <xls row="<?php echo $row?>"
                             width="<?php echo $excelWidthGDPX;?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             column-merge="<?php echo $excel_col[$begin+3]?>"
                             wrap-text="1"
                             h-align="center"
                             v-align="center"
                             border="0"
                             bold="1"> QĐPX</xls>
                    </th>
                    <?php $begin = $begin+3;?>

                    <?php $htmlWidthGDNM = $htmlColWidths[8] + $htmlColWidths[9] + $htmlColWidths[10] + $htmlColWidths[7]; ;?>
                    <?php $excelWidthGDNM = $excelColWidths[8] + $excelColWidths[9] + $excelColWidths[10] + $excelColWidths[7];?>
                    <th colspan="4" class="center" width="<?php echo $htmlWidthGDNM;?>px">
                        <xls row="<?php echo $row?>"
                             width="<?php echo $excelWidthGDNM;?>"
                             column="<?php echo $excel_col[++$begin]?>"
                             column-merge="<?php echo $excel_col[$begin+3]?>"
                             wrap-text="1"
                             h-align="center"
                             v-align="center"
                             border="0"
                             bold="1"> Giám đốc nhà máy</xls>
                    </th>
                    <?php $begin = $begin+3;?>
                </tr>
            </table>
        </div>
    </div>
</div>
